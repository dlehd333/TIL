# DBMS(database management system), RDBMS(relational database management system)

- 데이터베이스란 '데이터의 집합'을 의미한다
- DBMS란 데이터베이스를 관리/운영하는 시스템을 의미한다
- 데이터베이스는 여러 사용자나 응용프로그램이 공유하고 동시에 접근이 가능해야 한다
- 또한 무결성, 독립성, 중복 최소화(정규화), 제작 및 수정의 용이성, 데이터의 안전성 등의 특징을 가진다

---

- RDBMS는 관계형 데이터베이스 매니지먼트 시스템의 줄임말이다
- 이름에 "관계"가 붙어있는 것처럼, 관계가 중요한 의미를 가지는 데이터베이스이다
- 실제 사용하는 대부분의 데이터베이스를 의미한다

---

- 개발 직군에서 팀장(PM)급 이상이 되려면 데이터베이스 설계가 기본 소양이다. 데이터베이스 스키마 설계하는 것과 데이터베이스 정규화를 충족하는 일은 단순 코딩 실력과는 관계없이 논리적 사고를 요구한다
    - 데이터베이스 스키마란, 데이터베이스의 구조와 제약조건에 관해 전반적인 명세를 기술한 것을 의미한다. 쉽게 말해 DB가 어떤 구조로 데이터가 저장되는지 나타내는 구조를 의미한다
    - 데이터베이스 정규화란, 관계형 데이터베이스 설계에서 중복을 최소화하게 데이터를 구조화하는 프로세스를 의미한다.

---

- DBMS는 Oracle, MS-SQL이 대표적으로, 그 외에 MySQL(MariaDB), Postage-SQL, SQLite등이 있다.
    - 이는 크기 순(가격 순)으로 정렬된 것으로, Oracle, MS-SQL은 가장 큰 Enterprise급이고, SQLite는 가장 작은 Mobile급이다.
- 최근 빅데이터의 도래로 기존의 RDBMS로는 감당하기 힘들게 되자, 그 대안으로 NoSQL(Not only SQL)을 시작으로 여러 신기술이 사용되기도 한다

---

- Java가 주 언어인 경우 Oracle을 주로 사용하고, C#을 주 언어로 사용하는 경우에는 MS-SQL을 주력으로 사용하게 된다

# SQL(Structured Query Language)

- SQL은 관계형 데이터베이스에서 사용되는 언어를 말한다
- SQL 자체는 DBMS 제작사와 독립적이고, 다른 시스템으로의 이식성이 좋다
- 대화식 언어이고, 분산형 Client/Server 구조를 가지고 있다
- 단, 모든 DBMS의 SQL문이 완벽히 일치하지 않는다

# MS-SQL 설치 및 환경설정

## MS-SQL 설치

1. SQL Server 2019 이미지를 다운로드하여 마운트한다
2. setup.exe 실행
3. 설치 선택 → 새 SQL Server 독립 실행형 설치 또는 기존 설치에 기능 추가 선택
4. 기능 선택 → 데이터베이스 엔진 서비스 선택
    - 데이터베이스를 사용하려면 기본적으로 해당 항목을 선택한다
5. 인스턴스 구성
    - 변수(variable), 인스턴스(instance), 객체(object)는 같은 의미이다
    - 단, 클래스(class)나 타입(type)과는 다른 말이다
    - 인스턴스 ID는 자신이 사용할 데이터베이스의 이름을 의미한다
6. 데이터베이스 엔진 구성
    - '서버 구성 → 인증 모드' 에서 'Windows 인증 모드'란, SQL 서버의 계정을 Windows의 계정을 사용하겠다는 것을 의미한다. 거의 사용하지 않으니, '혼합 모드'를 사용한다
    - 혼합 모드를 선택한 뒤에, 시스템 관리자 계정 암호를 입력해준다
    - 'SQL Server 관리자 지정' 에서 '현재 사용자 추가'를 눌러 현재 사용자를 추가해준다
7. 계속 진행하여 설치해준다

## SSMS(SQL Server Management Studio) 설치

1. SSMS를 설치해준다
    - 모든 SQL 인프라를 관리하기 위한 통합 환경이다
2. Sql Server Configuration Manager 실행
    - MSSQLSERVER에 대한 프로토콜 → TCP/IP 설정 →
    - 프로토콜 - 모두 수신 - 아니요
    - IP1 - TCP 포트 변경 : 기본 포트는 해킹 및 접속 우려가 있다
    - IPAII - TCP 동적 포트를 설정
3. SSMS를 이용해 데이터베이스에 연결한다
    - 개체 탐색기 → 연결 → 데이터베이스 엔진
    - 서버 이름에 . 또는 127.0.0.1을 입력하면 자기 자신에게 연결한다
    - 서버 이름은 IP\인스턴스명,PORT번호 순으로 입력한다
    - 인스턴스명이 MSSQLSERVER, 포트번호가 1433이 기본 명칭이므로, 기본을 사용한다면 생략이 가능하다
    - 인증은 SQL 인증을 선택, 아이디는 sa, 비밀번호까지 입력하면 된다
4. 환경구성이 다 끝났다면 Hello World를 실행해보자
    - 데이터베이스에 우클릭 후 새 데이터베이스를 생성한다
    - 테이블에 우클릭 후 새로만들기 - 테이블로 새 테이블을 생성한다
    - 열 이름과 데이터 형식(nvarchar(50))을 선택한다
    - 이후, 테이블에 우클릭 후 테이블 편집을 선택한다
    - hello, world를 입력한다
    - '새 쿼리'를 선택하여 실행한다. 코드를 입력하고 F5를 누른다

    ```sql
    select * from [테이블명]
    ```

# Connection String

- 보통 C# 등의 프로그래밍 계층에서 SQL Server와 같은 데이터베이스 계층에 접근해서 데이터를 사용하고자 할 때는, 데이터베이스 연결 문자열(Connection String)이 필요하다.
- 연결에 입력하는 내용들이 이 데이터베이스 연결 문자열에 들어가는 내용들이다. 데이터베이스 연결 문자열의 구성요소는 Server(IP주소,도메인), Database(데이터베이스 이름), UserID, Password이다.
- 서버명은 서버명(IP,도메인)\인스턴스명,포트번호 순으로 입력한다

```csharp
Server=localhost; Database=master; User ID=UserId; Password=xyz;
Server=tcp:ServerName\InstanceName,PortNumber;
Server=10.10.16.150\MSSQLSERVER,1433;
```

- [connectionstrings.com](http://connectionstrings.com) - 서버의 형태 및 환경에 따른 데이터베이스 연결 문자열의 형태를 제공하는 사이트

# 유지 관리 계획

- 유지 관리 계획을 사용하면, 특정 빈도마다 특정 명령을 수행하도록 할 수 있다. 코드로 구성할 수도 있지만, SSMS에서 제공하는 도구를 활용할 수 있다
- 새 유지 관리 계획을 추가해 빈도를 설정한 후, 도구 상자를 통해 원하는 테스크를 계획하여 실행할 수 있다
- 백업을 한다고 가정하면,
    1. 데이터베이스 백업 테스크를 설정
    2. 계속 데이터가 백업되면 쌓이므로, 기록 정리 테스크를 추가하여 특정 기간이 지난 백업 데이터를 삭제하도록 처리
- 이런 식으로 여러 테스크가 계획에 따라 실행되도록 할 수도 있다

# 데이터베이스 테이블 구성

## 테이블 생성

- 새 데이터베이스 다이어그램을 생성한다
    - (데이터베이스 다이어그램 우클릭 후 새 데이터베이스 다이어그램)
- 다이어그램에서 새 테이블 추가, 이름을 작성
    - (다이어그램 우클릭 후 새 테이블)
- 이후, 테이블 구성 요소를 작성하고, 저장한다
- 우클릭 후 '선택한 테이블 크기 자동 조정'을 사용하면, 다이어그램 내 테이블이 입력한 내용에 따라 크기가 조정된다

## 열 이름

- 테이블의 열의 이름. 테이블의 열의 정보를 나타낸다.

## 데이터 형식

- 테이블의 열에 들어갈 데이터의 형식이다
- 다른 개발 언어처럼 특정 바이트에 해당하는 데이터 타입이 존재한다(예: int)

## Null 허용

- 해당 열에 Null데이터(빈 값, 없는값)이 들어갈 수 있는지 여부를 체크한다
- Null 허용이 체크되면, 빈 값이 들어갈 수 있게 된다

## 기본 키(Primary Key, PK)

- 테이블의 각 행들을 구분할 수 있는 식별자이다. 값이 중복될 수 없고, NULL값도 입력될 수 없다
- 기본키는 하나의 열 또는 여러 개의 열을 합쳐서 설정할 수 있으나, 하나만 설정할 수 있다
- 기본키는 테이블을 만들 때 부터 설정해놓는것이 좋다. 데이터가 있는 상태에서 기본키를 설정 시에 데이터가 꼬일 수 있다
- 기본 키를 설정하는 가장 좋은 방법은, 데이터를 구분할 수 있는 번호(ID)를 만들고 해당 열을 기본키로 설정하는것이 좋다
- 구분할 번호로 기본키를 만들고, 열의 속성에서 'ID 사양' 속성을 설정하면 데이터 입력시 자동으로 입력되게 할 수 있다

## 참조 무결성

- 참조 무결성이란, 2개의 관련 있는 테이블간의 일관성을 말한다
- 다른 테이블을 참조하는 테이블에서 값을 작성할 떄는, 참조하는 테이블에 값이 존재해야만 한다. 참조하는 테이블에 없는 데이터를 값으로 사용할 경우 참조 무결성이 깨졌다고 한다.
- 또한, 참조하는 테이블에서 값을 지워버리는 경우에도 참조 무결성이 깨졌다고 한다
- 무결성을 지키기 위해서는 특정 데이터를 입력할 때 무조건 입력되는 것이 아니라, 어떠한 조건을 만족했을 때에만 입력되도록 제한해야 한다
- 참조 무결성은 주로 기본 키 또는 후보 키와 외래 키의 조합으로 적용된다

## 외래 키(Foreign Key)

- 두 테이블 간의 관계를 선언함으로써 데이터의 무결성을 보장해준다
- 외래키 관계를 설정하면, 하나의 테이블이 다른 테이블에 의존하게 된다
- '외래키 테이블'에 데이터를 입력할 때는 꼭 '기준 테이블'을 참조해서 입력하므로, '기준 테이블'에 이미 데이터가 존재해야만 한다

## cascade(연쇄 삭제, 계단식 배열)

- cascade를 설정하면 테이블에서 특정 데이터를 삭제할 떄, 그 데이터를 참조하고 있는 다른 테이블의 데이터도 같이 삭제한다
- 외래키의 설정에서 삭제 조건에 cascade(계단식 배열)를 설정하면, 참조하는 테이블에서 값이 삭제되면, 관계가 연결된 테이블의 데이터도 함께 삭제가 된다

## 샘플 데이터베이스 시트

- MS-SQL에서는 데이터베이스 구조의 좋은 사례들이 예제로 나왔다
- NorthWind, AdventureWorks 등의 샘플 데이터베이스가 있다