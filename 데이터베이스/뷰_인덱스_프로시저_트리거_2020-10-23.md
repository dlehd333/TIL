# 뷰

- SELECT문으로 구성된 데이터베이스 개치, 가상의 테이블과 같다.
- 복잡한 쿼리를 단순화시켜 활용할 수 있다
- VIEW는 쿼리로 생성하거나, SSMS의 개체 탐색기를 통해 생성할 수도 있다

```sql
-- 뷰 생성
create view [뷰이름] as <select문>
```

- 사용할 때는, 뷰를 테이블이라고 생각하고 똑같이 사용해도 된다

# 인덱스

- 책의 뒷부분에 있는 색인(찾아보기)과 비슷한 개념이다. 데이터베이스에도 대량의 데이터를 검색할 때는 인덱스가 있어야만 한다
- 인덱스를 설정하면 검색속도가 매울 빨라질 수 있다. 이는 시스템의 부하의 감소로 이어지게 되어 시스템의 성능 향상으로 이어진다
- 단, 인덱스가 데이터베이스 공간을 차지해서 추가적인 공간이 필요해진다
- 또한, 데이터베이스가 크면 인덱스를 생성하는데 시간이 많이 소요되고, 데이터의 변경이 자주 일어날 경우 성능이 나빠질 수 있다
- 제약조건 없이 테이블을 생성할 경우 인덱스를 만들 수 없다

# 저장 프로시저

- SQL Server에서 제공되는 프로그래밍 기능
- SQL에서 반환값이 있는 형태는 "함수", 반환값이 없는 형태는 "저장 프로시저"로 불린다

## 기본 구문

```sql
-- 기본적인 프로시저 생성 쿼리
CREATE PROCEDURE -- 프로시저 이름
-- 매개변수 자리
AS
BEGIN
-- 실행할 구문이 들어가는 자리
END
```

- 해당 구문은 직접 작성하여 실행해도 되고, SMSS의 개채탐색기에서 프로그래밍 기능 - 저장 프로시저로 진입하여 우클릭하여 새 저장 프로시저를 생성하면 기본 구문을 생성해준다
- 프로시저는 프로그래밍의 함수와 구조가 비슷하다. 해당 쿼리 실행 시 함수가 생성되어 데이터베이스에 저장된다
- 맨 앞에 CREATE를 쓰면 프로시저의 생성, ALTER를 쓰면 프로시저의 수정을 의미한다
- 프로시저에는 필요한 매개변수를 넣을 수 있고, 실행할 구문에는 CRUD가 모두 가능하다

```sql
-- 프로시저 수정의 예제
alter procedure GetAlbumWithArtist -- 프로시저 이름
	@ArtistId int -- 매개변수 자리
as
begin
	select -- 실행할 구문이 들어가는 자리
		al.Title as AlbumName,
		ar.Name as ArtistName
	from Album as al
	join Artist as ar
		on al.ArtistId = ar.ArtistId
	where ar.ArtistId = @ArtistId
end
```

- 매개변수는 맨 첫줄과 as 사이에 넣어서 실행하며, 매개변수를 괄호로 감싸도 상관없다

```sql
exec GetAlbumWithArtist 5 -- 매개변수
```

- 생성한 프로시저를 실행하는 것은 exec를 쓰면 된다
- 프로시저의 매개변수는 공백으로 구분을 주어 입력하면 된다

## 장점

- 저장 프로시저를 반복하여 사용하는 것이 일반 쿼리를 반복해서 실행하는 것보다 네트워크의 부하를 줄이고 소프트웨어의 복잡도를 줄여 성능을 크게 향상시킨다
- 프로시저에도 개별로 접근권한을 부여할 수 있어, 사용자 별로 테이블 접근 권한을 주지 않고 프로시저에만 접근 권한을 주어 보안을 강화할 수 있다
- 프로시저를 생성해놓으면 언제든지 실행이 가능한 모듈식 프로그래밍이 가능해진다

# 트리거

- 테이블 또는 뷰에 부착되는 프로그램 코드
- 저장 프로시저와 비슷하게 작동하지만 직접 실행시킬 수는 없고, 오직 해당 테이블이나 뷰에 이벤트(insert, update, delete)가 발생할 경우에만 실행됨
- 매개변수나 리턴값은 사용할 수 없음

```sql
-- 트리거 생성 SQL 예제
create trigger testTig -- 트리거 이름
on testTbl -- 트리거를 부착할 테이블
after delete, update -- 삭제, 수정후에 작동하도록 지정
as
-- 트리거가 실행시 작동되는 부분
```