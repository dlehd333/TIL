# GPIO alternative function

- GPIO는 목적에 따라 입력 및 출력으로 사용할 수 있는, 마이크로프로세서가 다른 장치들과 소통하기 위해 사용하는 범용포트이다
- 라즈베리파이에는 총 40여개의 핀이 있는데, 전력공급 및 GND기능을 하는 핀을 제외하고는, GPIO핀으로 사용이 되나, GPIO핀들 중 특정 핀은 I2C, SPI, UART등 다양한 통신 기능을 위한 핀으로도 사용할 수 있다.
- 이렇게 GPIO 외에 다른 기능을 사용하기 위해서 하드웨어적으로 설계되어 나온 핀을 alternative function이라고 한다
- 자세한 내용은 데이터시트에서 확인하거나 pinout을 통해 확인이 가능하다

# 4x4 키패드

## 핀 구조

- 4x4 키패드는 매트릭스 형태로 이루어져 있어서, 실제 사용하는 핀은 8개이다. (가로(row) 4개, 세로(col) 4개)

## 동작 원리

- 신호를 판별할때는 가로 핀에 신호를 보내고, 세로 핀의 신호를 읽어 입력을 판단한다.
- 예를 들어 가로 2번 핀에 HIGH로 신호를 주고, 세로 핀의 값을 읽어 세로 3번 핀의 input이 HIGH가 뜨면 7번 버튼이 입력된 것으로 판단할 수 있다
- for문을 통해 계속해서 신호를 반복해서 주고받는 상태를 폴링(Polling) 상태라고 한다. 폴링은 인터럽트의 반대이다.
- 추가 : [디바운싱과 인터럽트](./디바운싱_인터럽트_2020-10-08.md)

## 예제

```python
for i in range(0,4):	
	# 가로 핀은 출력으로 설정, 초기 설정은 low
	GPIO.setup(KEY_R[i], GPIO.OUT, initial=GPIO.LOW)
	# 세로 핀은 입력으로 설정, 플로팅 현상을 제어하기 위해 풀다운 저항이 필요하다
	# 핀 내부에서 제공하는 풀다운 저항을 사용한다
	GPIO.setup(KEY_C[i], GPIO.IN, pull_up_down=GPIO.PUD_DOWN)
```

- 추가 : [플로팅 현상](./플로팅_현상_2020-10-12.md)

# 쓰레드

- 라즈베리파이(파이썬)에서 쓰레드 사용을 위한 라이브러리는 다음과 같다

```python
import threading
```

- 내가 쓰레드로 사용할 구문을 함수로 만들고 등록하면 간편하게 사용이 가능하다

```python
t1 = threading.Thread(target=LED_toggle)
t1.start()
```

- 쓰레드는 프로세스가 종료되어도 자동으로 종료되지 않을 수 있다. 그래서 프로세스 종료 시 쓰레드가 종료될 수 있도록 설계해야 한다

```python
# 프로세스 종료 시 쓰레드 종료 예제
# 쓰레드 함수 내부에 반복문을 빠져나올 장치 만듬
def LED_toggle():
# ...
	if thread_stop == 1:
		break

try:
	thread_stop = 0
# ...
finally:
	thread_stop = 1
	t1.join() # 쓰레드가 종료될 때 까지 대기상태로 진입
	# 이후, 쓰레드 함수 내에서 반복문을 빠져나와 쓰레드가 종료
```